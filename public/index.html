<html>
  <head>
    <script src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@7.0.0-alpha.15"></script>
  </head>
  <body>
    <div id="main"></div>

    <script type="text/babel" data-presets="es2015, react, stage-2">
      const NotesComponent = ({ onAdd, onRemove, notes, message }) => (
        <div>
          <h1>Notes</h1>
          <ul>
            {notes.map((n) => (
              <li key={n.id}>
                {n.value}
                <button
                  onClick={(e) => {
                    onRemove(n.id);
                  }}
                >
                  X
                </button>
              </li>
            ))}
          </ul>
          <input type="text" id="newNote" />
          <button
            onClick={() => {
              onAdd(document.getElementById("newNote").value);
              document.getElementById("newNote").value = "";
            }}
          >
            Add note
          </button>
          <div>{message}</div>
        </div>
      );

      const RootComponent = () => {
        const [notes, setNotes] = React.useState([]);
        const [message, setMessage] = React.useState("");

        const findNotes = async () => {
          return await fetch("/api/notes").then((r) => r.json());
        };

        const deleteNote = async (id) => {
          return await fetch(`/api/note/${id}`, {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
          });
        };

        React.useEffect(() => {
          (async () => {
            setNotes(await findNotes());
          })();
        }, []);

        const addNote = async (note) => {
          if (notes.length >= 10) {
            setMessage("Can't have more than 10 notes.");
            return;
          }
          await fetch("/api/note", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ note: note }),
          });
        };

        return (
          <NotesComponent
            message={message}
            notes={notes}
            onAdd={async (value) => {
              if (value) {
                setMessage("");
                await addNote(value);
                setNotes(await findNotes());
              } else {
                setMessage("Note can't be empty.");
              }
            }}
            onRemove={async (value) => {
              await deleteNote(value);
              setNotes(await findNotes());
            }}
          />
        );
      };

      ReactDOM.render(<RootComponent />, document.getElementById("main"));
    </script>
  </body>
</html>
